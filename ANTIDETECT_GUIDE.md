# üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞

Ozon –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–Ω—Ç–∏–±–æ—Ç-—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏. –í–æ—Ç —á—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏ –∏ —á—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å.

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **Stealth –∞—Ä–≥—É–º–µ–Ω—Ç—ã –±—Ä–∞—É–∑–µ—Ä–∞** (`main.py`):
```python
args=[
    '--disable-blink-features=AutomationControlled',  # –ì–ª–∞–≤–Ω–æ–µ!
    '--disable-dev-shm-usage',
    '--no-sandbox',
    '--disable-setuid-sandbox',
    '--disable-web-security',
    '--disable-features=IsolateOrigins,site-per-process',
    '--disable-infobars',
    '--ignore-certificate-errors',
]
```

### 2. **JavaScript –∏–Ω—ä–µ–∫—Ü–∏–∏**:
- –ü–æ–¥–º–µ–Ω–∞ `navigator.webdriver` ‚Üí `undefined`
- –§–∞–ª—å—à–∏–≤—ã–µ –ø–ª–∞–≥–∏–Ω—ã –±—Ä–∞—É–∑–µ—Ä–∞
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —è–∑—ã–∫–∏ –∏ –ª–æ–∫–∞–ª—å
- Canvas fingerprint –∑–∞—â–∏—Ç–∞
- WebGL fingerprint –∑–∞—â–∏—Ç–∞
- Chrome runtime –æ–±—ä–µ–∫—Ç

### 3. **–†–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—Ä–∞—É–∑–µ—Ä–∞**:
```python
viewport={'width': 1920, 'height': 1080}
locale='ru-RU'
timezone_id='Europe/Moscow'
geolocation={'longitude': 37.6173, 'latitude': 55.7558}  # –ú–æ—Å–∫–≤–∞
```

### 4. **–ß–µ–ª–æ–≤–µ–∫–æ–ø–æ–¥–æ–±–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** (`stealth.py`):
- –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏
- –ò–º–∏—Ç–∞—Ü–∏—è –ø–µ—á–∞—Ç–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- –°–ª—É—á–∞–π–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏
- –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–°

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ –Ω–µ–≥–æ–ª–æ–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ (—Å GUI) ‚úÖ

–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (–Ω–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ):

```powershell
# –í .env –∏–∑–º–µ–Ω–∏—Ç–µ:
HEADLESS=False
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```powershell
python main.py
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –í–∏–¥–∏—Ç–µ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- –ë—Ä–∞—É–∑–µ—Ä –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π Chrome
- –ú–µ–Ω—å—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–µ—Ç–µ–∫—Ç–∞
- –ú–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–π—Ç–∏ –∫–∞–ø—á—É –µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Firefox –≤–º–µ—Å—Ç–æ Chromium

Ozon –º–æ–∂–µ—Ç –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Playwright Chromium. Firefox –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∂–µ:

**–ò–∑–º–µ–Ω–∏—Ç–µ –≤ `main.py`:**

```python
# –ë—ã–ª–æ:
browser = p.chromium.launch(...)

# –°—Ç–∞–ª–æ:
browser = p.firefox.launch(
    headless=Config.HEADLESS,
    firefox_user_prefs={
        "geo.enabled": True,
        "geo.provider.use_corelocation": True,
        "geo.prompt.testing": True,
        "geo.prompt.testing.allow": True,
        "intl.accept_languages": "ru-RU, ru, en-US, en",
    }
)
```

–¢–∞–∫–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Firefox –¥–ª—è Playwright:
```bash
playwright install firefox
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –î–æ–±–∞–≤—å—Ç–µ playwright-stealth (Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)

**–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:**
```bash
pip install playwright-stealth
```

**–ò–∑–º–µ–Ω–∏—Ç–µ `main.py`:**
```python
from playwright_stealth import stealth_sync

# –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
page = context.new_page()
stealth_sync(page)  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ stealth —Ç–µ—Ö–Ω–∏–∫–∏
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–∫—Å–∏ —Å —Ä–æ—Å—Å–∏–π—Å–∫–∏–º IP

–ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π, Ozon –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å.

**–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–∫—Å–∏:**
```python
context = browser.new_context(
    ...
    proxy={
        'server': 'http://proxy.example.com:8080',
        'username': 'user',
        'password': 'pass'
    }
)
```

**–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –ø—Ä–æ–∫—Å–∏**:
- https://www.proxy-list.download/RUSSIA
- https://free-proxy-list.net/

---

### –í–∞—Ä–∏–∞–Ω—Ç 5: –£–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏

–°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è = –±–æ—Ç.

**–ò–∑–º–µ–Ω–∏—Ç–µ –≤ `config.py`:**
```python
DEFAULT_TIMEOUT = 60000  # –ë—ã–ª–æ 30000
NAVIGATION_TIMEOUT = 60000  # –ë—ã–ª–æ 45000
```

**–î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ `auth.py` –∏ `parser.py`:**
```python
from stealth import StealthHelper

# –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º:
StealthHelper.human_delay(1, 3)  # 1-3 —Å–µ–∫—É–Ω–¥—ã

# –ü–µ—Ä–µ–¥ –≤–≤–æ–¥–æ–º —Ç–µ–∫—Å—Ç–∞:
StealthHelper.human_type(page, selector, text)

# –ü–µ—Ä–µ–¥ –∫–ª–∏–∫–æ–º:
StealthHelper.human_click(page, selector)

# –°–ª—É—á–∞–π–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏:
StealthHelper.random_mouse_movement(page, 5)

# –°–ª—É—á–∞–π–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞:
StealthHelper.random_scroll(page, 'down')
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–µ—Ç–µ–∫—Ç —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω —Å–µ—Ä–≤–∏—Å:

–î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ `main.py`:
```python
page.goto('https://bot.sannysoft.com/')
page.wait_for_timeout(10000)
page.screenshot(path='bot_detection_test.png', full_page=True)
```

–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç - **–∑–µ–ª–µ–Ω—ã–µ** = —Ö–æ—Ä–æ—à–æ, **–∫—Ä–∞—Å–Ω—ã–µ** = –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç.

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–∏–¥–∏—Ç Ozon:

```python
page.goto('https://www.ozon.ru/')
result = page.evaluate('''() => {
    return {
        webdriver: navigator.webdriver,
        plugins: navigator.plugins.length,
        languages: navigator.languages,
        chrome: !!window.chrome,
        userAgent: navigator.userAgent
    }
}''')
print(result)
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
- `webdriver`: `undefined` –∏–ª–∏ `False` (–Ω–µ `True`!)
- `plugins`: > 0
- `languages`: `['ru-RU', 'ru', ...]`
- `chrome`: `True`

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –®–∞–≥ 1: –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# .env
HEADLESS=False
```
```bash
python main.py
```
–°–º–æ—Ç—Ä–∏–º —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç.

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å playwright-stealth
```bash
pip install playwright-stealth
```
–î–æ–±–∞–≤–∏—Ç—å `stealth_sync(page)` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

### –®–∞–≥ 3: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å Firefox
```python
browser = p.firefox.launch(...)
playwright install firefox
```

### –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —á–µ–ª–æ–≤–µ–∫–æ–ø–æ–¥–æ–±–Ω–æ—Å—Ç–∏
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `StealthHelper`
- –î–æ–±–∞–≤–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `human_type()` –∏ `human_click()`

### –®–∞–≥ 5: –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Selenium
Playwright –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –ª–µ–≥—á–µ —á–µ–º Selenium —Å undetected-chromedriver.

---

## üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

### 1. –û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª—ã:
```powershell
.\update-server.ps1
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```powershell
scp main.py stealth.py ozon@85.193.81.13:~/ozon_parser/
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–ª–∏ playwright-stealth):
```bash
ssh ozon@85.193.81.13
cd ~/ozon_parser
source venv/bin/activate
pip install playwright-stealth
```

### 3. –¢–µ—Å—Ç:
```bash
python main.py
```

---

## üö® –ü—Ä–∏–∑–Ω–∞–∫–∏ –¥–µ—Ç–µ–∫—Ç–∞

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –≤–∞—Å –¥–µ—Ç–µ–∫—Ç—è—Ç:**

1. ‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–∞–º–∞
2. ‚ùå –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞–ø—á–∞/–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. ‚ùå –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
4. ‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"
5. ‚ùå –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –¥—Ä—É–≥–æ–π –¥–æ–º–µ–Ω
6. ‚ùå –ü—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ / –æ—à–∏–±–∫–∞ 403

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤—ã—à–µ ‚òùÔ∏è

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä—é–∫–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π Chrome –ø—Ä–æ—Ñ–∏–ª—å:

```python
context = browser.new_context(
    user_data_dir='/path/to/chrome/profile',
    channel='chrome'  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Chrome –≤–º–µ—Å—Ç–æ Chromium
)
```

### –≠–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:

```python
device = p.devices['iPhone 12']
context = browser.new_context(**device)
```

–ú–æ–±–∏–ª—å–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è —Ä–µ–∂–µ.

### –û—Ç–∫–ª—é—á–∏—Ç—å automation –≤ Chrome –Ω–∞–ø—Ä—è–º—É—é:

```python
browser = p.chromium.launch(
    channel='chrome',  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Google Chrome
    args=['--disable-blink-features=AutomationControlled']
)
```

---

## ‚ùì FAQ

**Q: –ü–æ—á–µ–º—É headless=True –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è?**
A: –í headless —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä –∏–º–µ–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ GPU –∏ —Ç.–¥.). –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `headless=False` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.

**Q: –ú–æ–∂–µ—Ç –ª–∏ Ozon –∑–∞–±–∞–Ω–∏—Ç—å –º–æ–π –∞–∫–∫–∞—É–Ω—Ç?**
A: –ú–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ. –û–±—ã—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥–æ—Å—Ç—É–ø –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏. –ù–æ –≤—Å—ë –∂–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑—É–º–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏.

**Q: –ü–æ–º–æ–∂–µ—Ç –ª–∏ —Å–º–µ–Ω–∞ user-agent?**
A: –ß–∞—Å—Ç–∏—á–Ω–æ. –ù–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–Ω—Ç–∏–±–æ—Ç-—Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –¥–µ—Å—è—Ç–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –Ω–µ —Ç–æ–ª—å–∫–æ user-agent.

**Q: –°—Ç–æ–∏—Ç –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN?**
A: –î–∞, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–µ –≤ –†–æ—Å—Å–∏–∏. –†–æ—Å—Å–∏–π—Å–∫–∏–π IP —Å–Ω–∏–∂–∞–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

---

**–ù–∞—á–Ω–∏—Ç–µ —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –≤ –Ω–µ–≥–æ–ª–æ–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ (HEADLESS=False)!** üéØ
