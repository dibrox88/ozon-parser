#cloud-config
# Cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ Timeweb
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users:
  - name: ozon
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    # –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π SSH –∫–ª—é—á!
    # –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–∞ Windows: ssh-keygen -t ed25519
    # –ö–ª—é—á –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤: C:\Users\—Ñ—Ñ\.ssh\id_ed25519.pub
    ssh_authorized_keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAI... your_email@example.com
    # –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∫–ª—é—á, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ —Å—é–¥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ hostname
hostname: ozon-parser
fqdn: ozon-parser.local

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
package_update: true
package_upgrade: true

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
packages:
  # –ë–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã
  - git
  - curl
  - wget
  - htop
  - vim
  - nano
  - unzip
  # Python
  - python3
  - python3-pip
  - python3-venv
  - python3-dev
  # –°–∏—Å—Ç–µ–º–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è Playwright
  - libnss3
  - libnspr4
  - libatk1.0-0
  - libatk-bridge2.0-0
  - libcups2
  - libdrm2
  - libdbus-1-3
  - libxkbcommon0
  - libxcomposite1
  - libxdamage1
  - libxfixes3
  - libxrandr2
  - libgbm1
  - libasound2
  - libpango-1.0-0
  - libcairo2
  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
  - nginx
  - ufw
  - certbot
  - python3-certbot-nginx

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ timezone
timezone: Europe/Moscow

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
runcmd:
  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall
  - ufw default deny incoming
  - ufw default allow outgoing
  - ufw allow ssh
  - ufw allow 8000/tcp
  - ufw allow 80/tcp
  - ufw allow 443/tcp
  - echo "y" | ufw enable
  
  # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
  - mkdir -p /home/ozon/ozon_parser
  - chown -R ozon:ozon /home/ozon/ozon_parser
  
  # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
  - mkdir -p /home/ozon/ozon_parser/logs
  - mkdir -p /home/ozon/ozon_parser/screenshots
  - mkdir -p /home/ozon/ozon_parser/browser_state
  - chown -R ozon:ozon /home/ozon/ozon_parser
  
  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ swap (–¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ 2-4 –ì–ë RAM)
  - fallocate -l 2G /swapfile
  - chmod 600 /swapfile
  - mkswap /swapfile
  - swapon /swapfile
  - echo '/swapfile none swap sw 0 0' >> /etc/fstab
  
  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - touch /var/log/cloud-init-output.log
  - chmod 644 /var/log/cloud-init-output.log

# –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
final_message: |
  ========================================
  üöÄ –°–µ—Ä–≤–µ—Ä Ozon Parser –≥–æ—Ç–æ–≤!
  ========================================
  
  ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 'ozon' —Å–æ–∑–¥–∞–Ω
  ‚úÖ –ü–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
  ‚úÖ Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω
  ‚úÖ Timezone: Europe/Moscow
  ‚úÖ Swap: 2 –ì–ë
  
  üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
  
  1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH:
     ssh ozon@YOUR_SERVER_IP
  
  2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞:
     scp -r * ozon@YOUR_SERVER_IP:~/ozon_parser/
  
  3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É:
     cd ~/ozon_parser
     bash deploy.sh
  
  üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: QUICKSTART_DEPLOY.md
  
  ========================================
