# üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Ozon Parser –Ω–∞ Timeweb
# –°–µ—Ä–≤–µ—Ä: 85.193.81.13
# –î–∞—Ç–∞: 27 –æ–∫—Ç—è–±—Ä—è 2025

# ============================================
# –®–ê–ì 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
# ============================================

# –í –û–¢–î–ï–õ–¨–ù–û–ú PowerShell –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
ssh root@85.193.81.13
# –ü–∞—Ä–æ–ª—å: z7WcXt-QAEkr@L

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
adduser ozon
# –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: OzonParser2025!)
# –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è - Enter, Enter, Enter...

usermod -aG sudo ozon
id ozon
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: groups=1000(ozon),27(sudo)

# –í—ã—Ö–æ–¥
exit

# ============================================
# –®–ê–ì 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# ============================================

# –í –≠–¢–û–ú PowerShell (C:\Users\—Ñ—Ñ\Documents\Apps\Ozon_Parser):

# 2.1. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
scp -r *.py *.sh *.md *.txt *.yaml *.example ozon@85.193.81.13:~/

# 2.2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ Google credentials
scp google_credentials.json ozon@85.193.81.13:~/

# 2.3. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .env (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# scp .env ozon@85.193.81.13:~/

# ============================================
# –®–ê–ì 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ozon
# ============================================

ssh ozon@85.193.81.13
# –ü–∞—Ä–æ–ª—å: —Ç–æ—Ç, —á—Ç–æ –≤—ã —Å–æ–∑–¥–∞–ª–∏ –¥–ª—è ozon

# ============================================
# –®–ê–ì 4: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
# ============================================

mkdir -p ~/ozon_parser
mv ~/*.py ~/ozon_parser/
mv ~/*.sh ~/ozon_parser/
mv ~/*.md ~/ozon_parser/
mv ~/*.txt ~/ozon_parser/
mv ~/*.yaml ~/ozon_parser/
mv ~/*.json ~/ozon_parser/ 2>/dev/null || true
mv ~/*.example ~/ozon_parser/ 2>/dev/null || true

cd ~/ozon_parser
ls -la

# ============================================
# –®–ê–ì 5: –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
# ============================================

chmod +x *.sh
bash deploy.sh

# –í–ê–ñ–ù–û: –°–∫—Ä–∏–ø—Ç —Å–ø—Ä–æ—Å–∏—Ç Git URL - –Ω–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–π–º—ë—Ç 5-10 –º–∏–Ω—É—Ç

# ============================================
# –®–ê–ì 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
# ============================================

nano ~/ozon_parser/.env

# –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –í–°–ï –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
# - API_SECRET_KEY (—É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
# - TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
# - TELEGRAM_CHAT_ID=–≤–∞—à_chat_id
# - GOOGLE_SHEETS_URL=–≤–∞—à–∞_—Å—Å—ã–ª–∫–∞
# - OZON_EMAIL=–≤–∞—à_email
# - OZON_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: Ctrl+O, Enter, Ctrl+X

# ============================================
# –®–ê–ì 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ Google credentials
# ============================================

ls -la ~/ozon_parser/google_credentials.json
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞–π–ª —Ä–∞–∑–º–µ—Ä–æ–º ~2-3 KB

cat ~/ozon_parser/google_credentials.json | head -5
# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å JSON —Å –∫–ª—é—á–∞–º–∏

# ============================================
# –®–ê–ì 8: –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞ (systemd)
# ============================================

bash setup-systemd.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo systemctl status ozon-parser-api
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Active: active (running)

# –¢–µ—Å—Ç API
curl http://localhost:8000/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"status":"healthy",...}

# ============================================
# –®–ê–ì 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ (cron)
# ============================================

bash setup-cron.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞
crontab -l
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞: 0 9-21 * * * .../run_parser.sh

# ============================================
# –®–ê–ì 10: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞
# ============================================

cd ~/ozon_parser
source venv/bin/activate
python main.py

# –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç - —É–≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞!

# ============================================
# –®–ê–ì 11: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
# ============================================

# –õ–æ–≥–∏ API —Å–µ—Ä–≤–µ—Ä–∞
sudo journalctl -u ozon-parser-api -n 50

# –õ–æ–≥–∏ –ø–∞—Ä—Å–µ—Ä–∞
tail -50 ~/ozon_parser/logs/parser_*.log

# –õ–æ–≥–∏ cron (–ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞)
tail -50 ~/ozon_parser/logs/cron_*.log

# ============================================
# –®–ê–ì 12: –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
# ============================================

# –ü—Ä–æ–≤–µ—Ä–∫–∞ timezone
timedatectl
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Time zone: Europe/Moscow (MSK, +0300)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall
sudo ufw status
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã: 22, 80, 443, 8000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Å –≤–Ω–µ—à–Ω–µ–≥–æ –∞–¥—Ä–µ—Å–∞
curl http://85.193.81.13:8000/health
# –î–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å!

# ============================================
# üéâ –ì–û–¢–û–í–û! –ü–∞—Ä—Å–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!
# ============================================

# –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
# 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google Apps Script (CLOUD_INIT_GUIDE.md)
# 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx + SSL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): bash setup-nginx.sh
# 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: tail -f ~/ozon_parser/logs/*.log

# –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
# - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ API: sudo systemctl restart ozon-parser-api
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞: sudo systemctl status ozon-parser-api
# - –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏: sudo journalctl -u ozon-parser-api -f
# - –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞: cd ~/ozon_parser && source venv/bin/activate && python main.py
