# üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Timeweb - –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## –ß—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ?

–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è Ozon Parser –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Timeweb:

### üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **API Server** (`api_server.py`)
   - FastAPI —Å–µ—Ä–≤–µ—Ä –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞
   - REST API endpoints: `/health`, `/status`, `/trigger`, `/logs`
   - –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ Bearer token
   - Background tasks –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ** (`deploy.sh`)
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Python –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Playwright –±—Ä–∞—É–∑–µ—Ä–æ–≤
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ timezone (–ú–æ—Å–∫–≤–∞)

3. **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞**
   - **systemd** (`setup-systemd.sh`) - API —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
   - **cron** (`setup-cron.sh`) - –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ –∫–∞–∂–¥—ã–π —á–∞—Å —Å 9:00 –¥–æ 21:00 –ú–°–ö

4. **Google Apps Script** (`google-apps-script.js`)
   - –ö–Ω–æ–ø–∫–∞ –≤ Google Sheets –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–∞—Ä—Å–µ—Ä–∞
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

5. **Nginx** (`setup-nginx.sh`, `nginx-config.example`)
   - Reverse proxy –¥–ª—è API
   - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)
   - HTTPS –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É Timeweb

```bash
ssh root@YOUR_SERVER_IP
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
adduser ozon
usermod -aG sudo ozon
su - ozon
```

### –®–∞–≥ 3: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```powershell
# –ù–∞ –≤–∞—à–µ–º Windows –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
cd "C:\Users\—Ñ—Ñ\Documents\Apps\Ozon_Parser"
scp -r * ozon@YOUR_SERVER_IP:~/ozon_parser/
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd ~/ozon_parser
chmod +x *.sh
bash deploy.sh
```

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
nano ~/ozon_parser/.env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ (`Ctrl+O`, `Enter`, `Ctrl+X`).

### –®–∞–≥ 6: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Google credentials

```bash
# –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
scp google_credentials.json ozon@YOUR_SERVER_IP:~/ozon_parser/
```

### –®–∞–≥ 7: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
# API —Å–µ—Ä–≤–µ—Ä (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π)
bash setup-systemd.sh

# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
bash setup-cron.sh
```

### –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google Sheets (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Google –¢–∞–±–ª–∏—Ü—É
2. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí Apps Script
3. –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –∏–∑ `google-apps-script.js`
4. –ò–∑–º–µ–Ω–∏—Ç–µ `API_BASE_URL` –∏ `API_SECRET_KEY`
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[DEPLOY_GUIDE.md](DEPLOY_GUIDE.md)** - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é
- **[QUICKSTART_DEPLOY.md](QUICKSTART_DEPLOY.md)** - –®–ø–∞—Ä–≥–∞–ª–∫–∞ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏

---

## üîë –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **API Secret Key** - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `.env`
   ```bash
   cat ~/ozon_parser/.env | grep API_SECRET_KEY
   ```

2. **–ü–æ—Ä—Ç 8000** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –≤ firewall
   ```bash
   sudo ufw allow 8000/tcp
   ```

3. **Timezone** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Europe/Moscow
   ```bash
   timedatectl
   ```

4. **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ cron** - –∫–∞–∂–¥—ã–π —á–∞—Å —Å 9:00 –¥–æ 21:00
   ```bash
   crontab -l
   ```

---

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# API —Å–µ—Ä–≤–µ—Ä
sudo systemctl status ozon-parser-api

# –õ–æ–≥–∏ API
sudo journalctl -u ozon-parser-api -f

# –õ–æ–≥–∏ –ø–∞—Ä—Å–µ—Ä–∞
tail -f ~/ozon_parser/logs/parser_*.log

# –õ–æ–≥–∏ cron
tail -f ~/ozon_parser/logs/cron_*.log
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ API
sudo systemctl restart ozon-parser-api

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞
cd ~/ozon_parser
source venv/bin/activate
python main.py
```

---

## üåê API Endpoints

```bash
# Health check
curl http://YOUR_SERVER_IP:8000/health

# –°—Ç–∞—Ç—É—Å (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é)
curl -H "Authorization: Bearer YOUR_API_KEY" \
     http://YOUR_SERVER_IP:8000/status

# –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é)
curl -X POST \
     -H "Authorization: Bearer YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{"source":"manual","force":false}' \
     http://YOUR_SERVER_IP:8000/trigger
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ API –∑–∞—â–∏—â—ë–Ω Bearer token
- ‚úÖ .env —Ñ–∞–π–ª –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ Git
- ‚úÖ google_credentials.json –≤ .gitignore
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx + SSL
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ IP

---

## üìû Troubleshooting

### API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `sudo systemctl status ozon-parser-api`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç: `sudo netstat -tulpn | grep 8000`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall: `sudo ufw status`

### –ü–∞—Ä—Å–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ cron
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -100 ~/ozon_parser/logs/cron_*.log`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞: `ls -la ~/ozon_parser/run_parser.sh`
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫: `bash ~/ozon_parser/run_parser.sh`

### Playwright –æ—à–∏–±–∫–∞
- –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: `playwright install chromium`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `playwright install-deps chromium`

---

## ‚úÖ –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ cron
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx + SSL –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–í–µ—Ä—Å–∏—è**: 1.9.0  
**–î–∞—Ç–∞**: 26 –æ–∫—Ç—è–±—Ä—è 2025
